<!doctype html>
<html lang="es">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>KARINA´S FRUIT MARKET</title>
  <meta name="description" content="Fruta Fresca en Abancay. Pedidos por WhatsApp. Yape." />

  <link rel="preconnect" href="https://fonts.googleapis.com">
  <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
  <link href="https://fonts.googleapis.com/css2?family=Poppins:wght@400;600;800&display=swap" rel="stylesheet">

  <style>
    :root{
      --bg:#ffffff;
      --text:#0f172a;
      --muted:#64748b;
      --border:#e5e7eb;
      --card:#ffffff;
      --shadow: 0 10px 30px rgba(15,23,42,.08);
      --radius:18px;
      --radius2:14px;
      --green:#16a34a;
      --blue:#2563eb;
      --dark:#0f172a;
      --chip:#f1f5f9;
      --danger:#ef4444;
    }
    *{box-sizing:border-box}
    body{
      margin:0;
      font-family:Poppins,system-ui,-apple-system,Segoe UI,Roboto,Arial;
      background:var(--bg);
      color:var(--text);
    }
    a{color:inherit;text-decoration:none}
    .wrap{max-width:1200px;margin:0 auto;padding:18px}
    header{
      position:sticky; top:0; z-index:50;
      background:rgba(255,255,255,.92);
      backdrop-filter: blur(12px);
      border-bottom:1px solid var(--border);
    }
    .topbar{
      display:flex; align-items:center; justify-content:space-between; gap:12px;
      padding:14px 18px;
      max-width:1200px; margin:0 auto;
    }
    .brand{display:flex; align-items:center; gap:12px; min-width:260px}
    .logo{
      width:44px;height:44px;border-radius:14px; border:1px solid var(--border);
      display:grid;place-items:center; overflow:hidden; background:#fff;
      box-shadow: 0 6px 18px rgba(0,0,0,.06);
      flex:0 0 auto;
    }
    .logo img{width:100%;height:100%;object-fit:cover}
    .brand h1{font-size:18px;line-height:1.1;margin:0;font-weight:800;letter-spacing:.2px}
    .brand p{margin:2px 0 0;color:var(--muted);font-size:12px}
    .actions{display:flex; align-items:center; gap:10px; flex-wrap:wrap; justify-content:flex-end}
    .pill{
      border:1px solid var(--border);
      background:#fff;
      padding:8px 12px;
      border-radius:999px;
      font-size:12px;
      color:var(--muted);
      display:flex; align-items:center; gap:8px;
      box-shadow: 0 6px 16px rgba(0,0,0,.04);
    }
    .btn{
      border:0;
      background:var(--green);
      color:#fff;
      padding:10px 14px;
      border-radius:12px;
      font-weight:800;
      cursor:pointer;
      box-shadow: 0 10px 20px rgba(22,163,74,.18);
      display:flex; align-items:center; gap:8px;
      font-size:13px;
      white-space:nowrap;
    }
    .btn.secondary{
      background:var(--blue);
      box-shadow: 0 10px 20px rgba(37,99,235,.18);
    }
    .btn.ghost{
      background:#fff;
      color:var(--text);
      border:1px solid var(--border);
      box-shadow: 0 10px 20px rgba(15,23,42,.06);
    }

    .hero{
      display:grid;
      grid-template-columns: 1.4fr .9fr;
      gap:16px;
      align-items:stretch;
      margin-top:16px;
    }
    @media (max-width: 980px){
      .hero{grid-template-columns:1fr}
      .brand{min-width:unset}
      .actions{justify-content:flex-start}
    }
    .card{
      background:var(--card);
      border:1px solid var(--border);
      border-radius:var(--radius);
      box-shadow:var(--shadow);
      padding:18px;
    }
    .hero h2{margin:0 0 6px;font-size:28px;line-height:1.1}
    .sub{margin:0;color:var(--muted);font-size:14px}
    .chips{display:flex;flex-wrap:wrap;gap:8px;margin-top:12px}
    .chip{
      background:var(--chip);
      border:1px solid var(--border);
      color:#334155;
      padding:8px 10px;
      border-radius:999px;
      font-size:12px;
      font-weight:600;
    }
    .small{font-size:11px;color:var(--muted);margin-top:8px}

    .gridHead{
      display:flex; align-items:flex-end; justify-content:space-between; gap:12px;
      margin-top:20px;
    }
    .gridHead h3{margin:0;font-size:22px}
    .gridHead .tools{display:flex; gap:10px; flex-wrap:wrap}
    .input, .select{
      border:1px solid var(--border);
      border-radius:12px;
      padding:10px 12px;
      font-size:13px;
      background:#fff;
      min-width:220px;
    }
    .select{min-width:180px}

    .catalog{
      display:grid;
      grid-template-columns: repeat(4, 1fr);
      gap:14px;
      margin-top:14px;
    }
    @media (max-width:1100px){ .catalog{grid-template-columns: repeat(3, 1fr);} }
    @media (max-width:820px){ .catalog{grid-template-columns: repeat(2, 1fr);} }
    @media (max-width:520px){ .catalog{grid-template-columns: 1fr;} }

    .item{
      border:1px solid var(--border);
      border-radius:var(--radius);
      overflow:hidden;
      background:#fff;
      box-shadow: 0 10px 24px rgba(15,23,42,.06);
      display:flex; flex-direction:column;
    }
    .thumb{height:150px; background:#f8fafc; display:block}
    .thumb img{
      width:100%; height:100%;
      object-fit:cover;
      display:block;
    }
    .content{padding:14px}
    .name{margin:0 0 6px; font-weight:800; font-size:15px}
    .price{margin:0 0 10px; color:#0f172a; font-size:12px; line-height:1.35}
    .price strong{color:var(--green)}
    .row{display:flex; gap:10px; align-items:center; flex-wrap:wrap}
    .qty{
      width:120px;
      border:1px solid var(--border);
      border-radius:12px;
      padding:10px 10px;
      font-size:13px;
      background:#fff;
    }

    /* BOTONES DE UNIDAD (KILO/CIENTO/UNIDAD/FRASCO) */
    .unitBtns{display:flex; gap:8px; flex-wrap:wrap; margin:10px 0 10px}
    .uBtn{
      border:1px solid var(--border);
      background:#fff;
      color:var(--text);
      border-radius:999px;
      padding:8px 10px;
      font-size:12px;
      font-weight:800;
      cursor:pointer;
      box-shadow: 0 8px 18px rgba(15,23,42,.05);
    }
    .uBtn.active{
      border-color: rgba(22,163,74,.35);
      background: rgba(22,163,74,.08);
      color: #0b3b1a;
    }

    .add{
      flex:1 1 auto;
      border:0;
      border-radius:12px;
      padding:10px 12px;
      cursor:pointer;
      background:var(--dark);
      color:#fff;
      font-weight:900;
      font-size:13px;
    }
    .add:hover{filter:brightness(1.05)}

    .cartBox h4{margin:0 0 10px;font-size:16px}
    .cartList{display:flex; flex-direction:column; gap:10px; margin-top:10px; max-height:360px; overflow:auto}
    .cartItem{
      border:1px solid var(--border);
      border-radius:14px;
      padding:10px 10px;
      display:flex; justify-content:space-between; align-items:flex-start; gap:10px;
      background:#fff;
    }
    .cartItem b{display:block;font-size:13px}
    .cartItem span{display:block;font-size:12px;color:var(--muted)}
    .cartItem .rm{
      border:1px solid var(--border);
      background:#fff;
      border-radius:10px;
      padding:6px 8px;
      cursor:pointer;
      font-weight:900;
      color:var(--danger);
    }
    .total{
      display:flex; justify-content:space-between; align-items:center;
      margin-top:12px; padding-top:12px;
      border-top:1px solid var(--border);
      gap:10px;
    }
    .total strong{font-size:18px}

    footer{
      border-top:1px solid var(--border);
      margin-top:22px;
      padding:16px 0;
      color:var(--muted);
      font-size:12px;
      text-align:center;
    }
  </style>
</head>

<body>
<header>
  <div class="topbar">
    <div class="brand">
      <div class="logo" title="Logo">
        <img id="logoImg" alt="Logo" />
      </div>
      <div>
        <h1>KARINA´S FRUIT MARKET</h1>
        <p>Fruta Fresca · Abancay · Pedidos por WhatsApp</p>
      </div>
    </div>

    <div class="actions">
      <div class="pill">Horario: 8.30 a.m – 8.30 p.m</div>
      <div class="pill" id="cartCountPill">Carrito: 0</div>
      <a class="btn secondary" id="fbBtn" target="_blank" rel="noopener">Facebook</a>
      <!-- BOTÓN ARRIBA: ENVÍO -->
      <button class="btn" id="sendBtn">Enviar pedido</button>
    </div>
  </div>
</header>

<main class="wrap">
  <section class="hero">
    <div class="card">
      <h2>ELIGE TUS FRUTAS FRESCAS , SEPARA TU PEDIDO.</h2>
      <p class="sub">
        Dirección: <b>ABANCAY - AV ARENAS 1526 ZOTANO DE TOPITOP </b> · Pago: <b>Yape</b> · WhatsApp: <b>973491877</b>
      </p>
      <div class="chips">
        <div class="chip">Precios claros</div>
        <div class="chip">Pedido por WhatsApp</div>
        <div class="chip">Atención el mismo día</div>
      </div>
      <p class="small">
        FRUTAS FRESCAS TODOS LOS DIAS - POR CIENTOS Y KILOS 
      </p>
    </div>

    <aside class="card cartBox">
      <h4>Carrito</h4>
      <div class="total">
        <div>
          <div style="font-size:12px;color:var(--muted);font-weight:700;">Total estimado</div>
          <strong id="totalText">S/. 0.00</strong>
        </div>
        <!-- BOTÓN APARTE EN CARRITO -->
        <button class="btn" id="waBtn">WhatsApp</button>
      </div>
      <div class="cartList" id="cartList"></div>
      <p class="small">Nota: El total es estimado según tus precios. Confirmas por WhatsApp.</p>
    </aside>
  </section>

  <div class="gridHead">
    <div>
      <h3>Catálogo</h3>
      <div class="sub">Mostrando productos</div>
    </div>
    <div class="tools">
      <input class="input" id="search" placeholder="Buscar (ej. mango, plátano, palta)..." />
      <select class="select" id="cat">
        <option value="all">Todas las categorías</option>
        <option value="platano">Plátanos</option>
        <option value="citricos">Cítricos</option>
        <option value="fruta">Frutas</option>
        <option value="otros">Otros</option>
      </select>
      <button class="btn ghost" id="clearBtn">Limpiar filtros</button>
    </div>
  </div>

  <section class="catalog" id="catalog"></section>
</main>

<footer>© KARINA´S FRUIT MARKET</footer>

<script>
  // ========= CONFIGURACIÓN =========
  const WHATSAPP = "973491877"; // sin +51
  const FACEBOOK_URL = "https://www.facebook.com/share/1AfKvrai1R/?mibextid=wwXIfr";

  // ========= IMÁGENES (NOMBRES EXACTOS + ajipili.png) =========
  const IMAGES = {
    logo: "img/logo.png",

    chirimoya: "img/CHIRIMOYAS_.png",
    limon_sutil: "img/limon sutil.png",
    limon_injeto: "img/limoninjeto.png",
    limon_tahiti: "img/limontahiti.png",
    lucma: "img/lucma.png",
    mandarina: "img/mandarina.png",
    mango_haden: "img/mangohaden.png",
    maracuya: "img/maracuya.png",
    naranja: "img/naranja.png",
    palta_fuerte: "img/paltafuerte.png",
    palta_hass: "img/paltahass.png",
    papaya: "img/papaya.png",
    platano_isla_rojo: "img/platano_isla rojo.png",
    platano_isla: "img/platano_isla.png",
    platano_seda: "img/platano_seda.png",

    ajipili: "img/ajipili.png"
  };

  // encodeURI mantiene el nombre tal cual (con espacios), pero lo hace URL-safe
  const safeImg = (p)=> encodeURI(p);

  // ========= PRODUCTOS (BOTONES DE UNIDAD) =========
  // unitOptions => botones (KILO/CIENTO/UNIDAD/FRASCO)
  const PRODUCTS = [
    {
      id:"platano_seda", name:"Plátano seda", cat:"platano",
      img: IMAGES.platano_seda,
      unitOptions:[
        { key:"unidad", label:"UNIDAD", price:0.40 },
        { key:"ciento", label:"CIENTO", price:40.00 }
      ]
    },
    {
      id:"platano_isla", name:"Plátano isla", cat:"platano",
      img: IMAGES.platano_isla,
      unitOptions:[
        { key:"unidad", label:"UNIDAD", price:0.30 },
        { key:"ciento", label:"CIENTO", price:30.00 }
      ]
    },
    {
      id:"platano_isla_rojo", name:"Plátano de isla rojo", cat:"platano",
      img: IMAGES.platano_isla_rojo,
      unitOptions:[
        { key:"unidad", label:"UNIDAD", price:0.40 },
        { key:"ciento", label:"CIENTO", price:40.00 }
      ]
    },

    { id:"mandarina", name:"Mandarina", cat:"citricos", img: IMAGES.mandarina,
      unitOptions:[{ key:"kilo", label:"KILO", price:3.00 }]
    },
    { id:"naranja_huando", name:"Naranja Huando", cat:"citricos", img: IMAGES.naranja,
      unitOptions:[{ key:"kilo", label:"KILO", price:3.00 }]
    },
    { id:"naranja_jugo", name:"Naranja de jugo", cat:"citricos", img: IMAGES.naranja,
      unitOptions:[{ key:"kilo", label:"KILO", price:3.00 }]
    },

    { id:"limon_tahiti", name:"Limón Tahití", cat:"citricos", img: IMAGES.limon_tahiti,
      unitOptions:[{ key:"kilo", label:"KILO", price:3.00 }]
    },
    { id:"limon_sutil", name:"Limón sutil", cat:"citricos", img: IMAGES.limon_sutil,
      unitOptions:[{ key:"kilo", label:"KILO", price:2.50 }]
    },
    { id:"limon_injeto", name:"Limón injerto", cat:"citricos", img: IMAGES.limon_injeto,
      unitOptions:[{ key:"kilo", label:"KILO", price:2.00 }]
    },

    { id:"mango_haden", name:"Mango Haden", cat:"fruta", img: IMAGES.mango_haden,
      unitOptions:[{ key:"kilo", label:"KILO", price:4.00 }]
    },
    // No subiste imagen de mango común: uso la de Mango Haden para no romper
    { id:"mango_comun", name:"Mango común", cat:"fruta", img: IMAGES.mango_haden,
      unitOptions:[{ key:"kilo", label:"KILO", price:3.00 }]
    },

    { id:"papaya", name:"Papaya", cat:"fruta", img: IMAGES.papaya,
      unitOptions:[{ key:"kilo", label:"KILO", price:3.00 }]
    },
    { id:"lucma", name:"Lúcuma", cat:"fruta", img: IMAGES.lucma,
      unitOptions:[{ key:"kilo", label:"KILO", price:4.00 }]
    },

    { id:"palta_fuerte", name:"Palta Fuerte", cat:"fruta", img: IMAGES.palta_fuerte,
      unitOptions:[
        { key:"kilo", label:"KILO", price:4.00 },
        { key:"ciento", label:"CIENTO", price:100.00 }
      ]
    },
    { id:"palta_hass", name:"Palta Hass", cat:"fruta", img: IMAGES.palta_hass,
      unitOptions:[
        { key:"kilo", label:"KILO", price:3.00 },
        { key:"ciento", label:"CIENTO", price:80.00 }
      ]
    },

    { id:"maracuya", name:"Maracuyá", cat:"fruta", img: IMAGES.maracuya,
      unitOptions:[{ key:"kilo", label:"KILO", price:2.50 }]
    },
    { id:"chirimoya", name:"Chirimoya", cat:"fruta", img: IMAGES.chirimoya,
      unitOptions:[{ key:"kilo", label:"KILO", price:4.00 }]
    },

    { id:"aji_pilis", name:"Ají pilis", cat:"otros", img: IMAGES.ajipili,
      unitOptions:[{ key:"frasco", label:"FRASCO", price:5.00 }]
    }
  ];

  // ========= UTILIDADES =========
  const money = (n)=>`S/. ${Number(n).toFixed(2)}`;
  const labelPrice = (opt)=>{
    const u = opt.key;
    if(u==="kilo") return `${money(opt.price)} SOLES EL KILO`;
    if(u==="ciento") return `${money(opt.price)} SOLES EL CIENTO`;
    if(u==="unidad") return `${money(opt.price)} SOLES LA UNIDAD`;
    if(u==="frasco") return `${money(opt.price)} SOLES EL FRASCO`;
    return `${money(opt.price)}`;
  };

  // ========= ESTADO =========
  let cart = []; // {id, name, unitKey, unitLabel, price, qty, lineTotal}
  let q = "";
  let cat = "all";

  // ========= ELEMENTOS =========
  const catalogEl = document.getElementById("catalog");
  const cartListEl = document.getElementById("cartList");
  const totalTextEl = document.getElementById("totalText");
  const cartCountPill = document.getElementById("cartCountPill");
  const waBtn = document.getElementById("waBtn");
  const sendBtn = document.getElementById("sendBtn");
  const fbBtn = document.getElementById("fbBtn");
  const logoImg = document.getElementById("logoImg");

  fbBtn.href = FACEBOOK_URL;
  logoImg.src = safeImg(IMAGES.logo);

  // ========= FILTRO =========
  function filteredProducts(){
    return PRODUCTS.filter(p=>{
      const okQ = (p.name.toLowerCase().includes(q) || p.id.toLowerCase().includes(q));
      const okC = (cat==="all" ? true : p.cat===cat);
      return okQ && okC;
    });
  }

  // ========= CATÁLOGO =========
  function renderCatalog(){
    const list = filteredProducts();
    catalogEl.innerHTML = "";

    list.forEach(p=>{
      const el = document.createElement("article");
      el.className = "item";

      const thumb = document.createElement("div");
      thumb.className = "thumb";
      const img = document.createElement("img");
      img.alt = p.name;
      img.loading = "lazy";
      img.src = safeImg(p.img);
      thumb.appendChild(img);

      const content = document.createElement("div");
      content.className = "content";

      const name = document.createElement("p");
      name.className = "name";
      name.textContent = p.name;

      const price = document.createElement("p");
      price.className = "price";
      price.innerHTML = p.unitOptions.map(o => `• <strong>${labelPrice(o)}</strong>`).join("<br>");

      // BOTONES DE UNIDAD (en vez de select)
      const unitBtns = document.createElement("div");
      unitBtns.className = "unitBtns";

      // default: si existe kilo => kilo, si no => primera opción
      let activeUnitKey = p.unitOptions.some(o=>o.key==="kilo") ? "kilo" : p.unitOptions[0].key;

      function renderUnitButtons(){
        unitBtns.innerHTML = "";
        p.unitOptions.forEach(o=>{
          const b = document.createElement("button");
          b.type = "button";
          b.className = "uBtn" + (o.key===activeUnitKey ? " active" : "");
          b.textContent = o.label;
          b.title = labelPrice(o);
          b.addEventListener("click", ()=>{
            activeUnitKey = o.key;
            renderUnitButtons();
            adjustQtyStep();
          });
          unitBtns.appendChild(b);
        });
      }

      const row = document.createElement("div");
      row.className = "row";

      const qty = document.createElement("input");
      qty.type = "number";
      qty.value = "1";
      qty.className = "qty";
      qty.placeholder = "Cantidad";

      function adjustQtyStep(){
        const uk = activeUnitKey;
        if(uk==="kilo"){
          qty.step = "0.1";
          qty.min = "0.1";
          if(!qty.value || Number(qty.value)<=0) qty.value = "1";
        }else{
          qty.step = "1";
          qty.min = "1";
          const v = Number(qty.value);
          qty.value = String(Math.max(1, Math.round(Number.isFinite(v)?v:1)));
        }
      }

      const add = document.createElement("button");
      add.className = "add";
      add.textContent = "Agregar";

      add.addEventListener("click", ()=>{
        const opt = p.unitOptions.find(o=>o.key===activeUnitKey);
        if(!opt) return;

        let n = Number(qty.value);
        if(!Number.isFinite(n) || n<=0) return;

        if(activeUnitKey!=="kilo") n = Math.round(n); // entero para unidad/ciento/frasco
        const lineTotal = opt.price * n;

        cart.push({
          id:p.id,
          name:p.name,
          unitKey: activeUnitKey,
          unitLabel: opt.label,
          price: opt.price,
          qty: n,
          lineTotal
        });
        renderCart();
      });

      renderUnitButtons();
      adjustQtyStep();

      row.appendChild(qty);
      row.appendChild(add);

      const small = document.createElement("div");
      small.className = "small";
      small.textContent = p.unitOptions.length > 1
        ? "Elige KILO / CIENTO / UNIDAD (según corresponda) y luego pon cantidad."
        : " ";

      content.appendChild(name);
      content.appendChild(price);
      content.appendChild(unitBtns);
      content.appendChild(row);
      content.appendChild(small);

      el.appendChild(thumb);
      el.appendChild(content);
      catalogEl.appendChild(el);
    });
  }

  // ========= CARRITO =========
  function renderCart(){
    cartListEl.innerHTML = "";

    const total = cart.reduce((a,b)=>a + b.lineTotal, 0);
    totalTextEl.textContent = money(total);
    cartCountPill.textContent = `Carrito: ${cart.length}`;

    if(cart.length===0){
      const empty = document.createElement("div");
      empty.className = "small";
      empty.textContent = "Tu carrito está vacío. Agrega productos para enviar tu pedido.";
      cartListEl.appendChild(empty);
      return;
    }

    cart.forEach((c, idx)=>{
      const el = document.createElement("div");
      el.className = "cartItem";

      const left = document.createElement("div");
      const b = document.createElement("b");
      b.textContent = c.name;
      const s = document.createElement("span");
      s.textContent = `${c.qty} x ${c.unitLabel} · ${money(c.price)} c/u · Subtotal: ${money(c.lineTotal)}`;
      left.appendChild(b);
      left.appendChild(s);

      const rm = document.createElement("button");
      rm.className = "rm";
      rm.textContent = "X";
      rm.title = "Quitar";
      rm.addEventListener("click", ()=>{
        cart.splice(idx,1);
        renderCart();
      });

      el.appendChild(left);
      el.appendChild(rm);
      cartListEl.appendChild(el);
    });
  }

  // ========= WHATSAPP =========
  function buildWhatsAppMessage(){
    const lines = [];
    lines.push("Hola, quiero hacer este pedido:");
    lines.push("");

    cart.forEach((c,i)=>{
      lines.push(`${i+1}) ${c.name} — ${c.qty} ${c.unitLabel} — ${money(c.lineTotal)}`);
    });

    const total = cart.reduce((a,b)=>a + b.lineTotal, 0);
    lines.push("");
    lines.push(`TOTAL ESTIMADO: ${money(total)}`);
    lines.push("");
    lines.push("RECOJO:AV.ARENAS ZOTANO DE TOPITOP");
    lines.push("Gracias por su compra.");
    return lines.join("\n");
  }

  function openWhatsApp(){
    if(cart.length===0){
      alert("Primero agrega productos al carrito.");
      return;
    }
    const text = encodeURIComponent(buildWhatsAppMessage());
    const url = `https://wa.me/51${WHATSAPP}?text=${text}`;
    window.open(url, "_blank");
  }

  // Botón arriba y botón en carrito (separados) => ambos envían WhatsApp
  waBtn.addEventListener("click", openWhatsApp);
  sendBtn.addEventListener("click", openWhatsApp);

  // ========= FILTROS =========
  document.getElementById("search").addEventListener("input", (e)=>{
    q = e.target.value.trim().toLowerCase();
    renderCatalog();
  });
  document.getElementById("cat").addEventListener("change", (e)=>{
    cat = e.target.value;
    renderCatalog();
  });
  document.getElementById("clearBtn").addEventListener("click", ()=>{
    document.getElementById("search").value = "";
    document.getElementById("cat").value = "all";
    q=""; cat="all";
    renderCatalog();
  });

  // ========= INIT =========
  renderCatalog();
  renderCart();
</script>
</body>
</html>
